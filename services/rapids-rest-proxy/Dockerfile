FROM node:15-alpine

RUN apk update

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm install

ARG PORT=8080
ENV \
	CLOUDEVENT_MECHANISM=$CLOUDEVENT_MECHANISM \
	CLOUDEVENT_PASSWORD=$CLOUDEVENT_PASSWORD \
	CLOUDEVENT_PROTOCOL=$CLOUDEVENT_PROTOCOL \
	CLOUDEVENT_URLS=$CLOUDEVENT_URLS \
	CLOUDEVENT_USERNAME=$CLOUDEVENT_USERNAME \
	HOST=0.0.0.0 \
	NODE_ENV=production \
	PORT=$PORT

EXPOSE $PORT

COPY . .

CMD [ "npm", "run", "start" ]
